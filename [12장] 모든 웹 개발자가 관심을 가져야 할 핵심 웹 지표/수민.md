# 핵심 웹 지표

웹사이트에 접속했을때 공통적으로 기대하는 사항

1. 방문한 목적 달성
2. 목적달성을 위해 걸리는시간이 짧아야 한다.
3. 보안

웹사이트 성능과 사용자 경험의 상관관계

- 페이지 로드시간이 0~2초 사이인 페이지에서 가장 높은 전환률을 달성
- 소비자의 70%가 페이지 속도가 사이트를 방문하는데 영향을 끼친다고 밝힘
- 평균 웹페이지 요청시간은 15.3초 , 1초에서 10초로 늘어날수록 사이트 이탈 확률 123%증가

> 사용자 경험에 더 우세한 CSR이 점차줄어들고 SSR이 떠오르는 이유..

# 핵심 웹 지표(Core Web Vital)

구글이 제시한 웹사이트에서 뛰어난 사용자 경험을 제공하는데 필수적인 지표

## 최대 콘텐츠풀 페인트 (LCP)

페이지가 처음으로 로드를 시작한 시점부터 부포트 내부에서 가장 큰 이미지 또는 텍스트를 렌더링하는데 걸리는 시간.

<aside>
💡

가장큰 이미지 또는 텍스트?

</aside>

- <img>
- <svg>내부의 <image>
- poster속성을 사용하는 <video>
- url()을 통해 불러온 배경이미지가 있는 요소
- 인라인 텍스트 요소를 포함하고있는 블록레벨 요소 (p,div)

<aside>
💡

사용자의 기준으로 로딩이란 뷰포트에 보이는 영역을 기준으로 한다 !

</aside>

⇒DOMContentLoaded(HTML문서를 완전히 불러오고 파싱했을때 발생하는 이벤트)로 측정한다면 스타일시트 ,이미지 하위프레임의 로딩은 기다리지 않기 때문에 개발자가 예상한 로딩시간과 사용자가 느끼는 로딩시간의 차이가 있다.

기준 점수 2.5초 내로 응답이 오면 좋은 점수 4초가 넘어가면 나쁜 점수

개선 사항 가장 확실한 방법은 최대 컨텐츠 예상영역에 이미지가 아닌 문자열을 넣는것이다.

하지만 사용자에게 강렬한 인상을 주려면 이미지의 사용은 불가피 하다.

그렇다면 이미지를 불러오는 방식에 대해 접근해보자

1. img태그
2. svg태그 속에 image태그
3. poster요소를 포함한 video 태그
4. 백그라운드 이미지

<aside>
❓

- 어떤 콘텐츠가 빠르게 로드되고 느리게 로드될까요?
  3-1-2=4 순

</aside>

# 왜?

### <img>

브라우저의 프리로드 스캐너에 먼저 포착된다

프리로드 스캐너란 HTML을 파싱하는 단계를 차단하지않고 이미지와 같이 빠르게 미리 로딩하면 좋을 리소스를 먼저 찾아 로딩하는 브라우저기능이다.

<picture>도 마찬가지

### <svg>내부의 <image>

브라우저의 프리로드 스캐너에 발견되지않는다.

모든 리소스를 다 불러온 후에 이미지를 불러오기 때문에 느리다

### poster요소를 포함한 video 태그

브라우저의 프리로드 스캐너에 먼저 포착된다

포스터 요소를 반드시 넣어주자!

### 백그라운드 이미지

CSS안에 있는 리소스는 항상 느리다

브라우저가 해당 리소스를 필요로하는 DOM을 그릴 준비가 될 때 까지 리소스 요청을 뒤로 미루기 때문

### 그밖에 조심해야 할 사항

- 이미지 무손실 압축
- loading-lazy주의 (LCP의 이미지를 중요하지 않은 리소스로 분류하기 때문)
- 애니메이션 효과(초 가 설정되어있는 효과들은 그만큼 페인트가 늦어진다)
- 클라이언트에서 빌드 주의 (파싱과정이 더 늘어난다)

## 최초 입력 지연(FID)

사용자가 처음 페이지와 상호작용 할때 이벤트 핸들러 처리를 시작하기까지의 시간

<aside>
❓

왜 이벤트가 느려질까?

</aside>

# 싱글스레드이기때문에!

대규모로 렌더링을 실행하는등 메인스레드가 바쁜경우 다른작업 지연

100ms미만으로 이벤트를 처리하는것이 좋은 반응이다. 300ms 이후는 BAD

<aside>
❓

어떻게 개선시킬까?

</aside>

- 실행에 오래 걸리는 긴 작업 분리 (당장의 로딩이 필요하지 않은 리소스= dynamic,lazy)

- 자바스크립트 코드 최소화

  - 개발자 도구에 커버리지 탭으로 사용되지않는 코드 확인

  - 폴리필(브라우저에서 지원하지않는 기능을 사용하기 위해 직접 구현 코드 작성)의 필요성 확인

- 타사 자바스크립트 코드 async, defer로 스크립트 병렬 다운로드

## 누적 레이아웃 이동 (CLS)

페이지의 생명주기 동안 발생하는 모든 예기치 않은 이동에 개한 지표

뷰포트 안에서 범위가 측정되며 사용자의 액션으로 발생한 레이아웃 이동은 점수에 포함 되지않는다.

<aside>
💡

점수 계산 방식

- 영향분율 : 레이아웃 이동이 발생한 요소의 전체 높이와 뷰포트 높이의 비율
  - ex) 레이아웃 이동이 발생한 요소의 높이가 10, 예기치 않은 레이아웃 이동으로 인해 10만큼 내려갔고, 뷰포트의 높이가 100이라고 가정한다면, 레이아웃 이동으로 인해 총 10+10만큼 뷰포트에 영향을 미쳤으므로, 이 경우 영향분율은 0.2점!
- 거리분율 : 레이아웃 이동이 발생한 요소가 뷰포트 대비 얼마나 이동했는지 - ex) 예기치 않은 레이아웃 이동으로 인해 10만큼 내려갔고, 전체 뷰포트가 100이라면 0.1점!
  </aside>

  0.1이하인 경우 좋음 0.25이상이면 BAD

### 개선 방법

- 스켈레톤UI 등을 활용해 미리 노출이 예상되는 부분을 HTML로 잡아둔다.

- useEffect 최소화 →useLayoutEffect 신중히 고려

- 서버사이드렌더링

- 폰트 로딩 최적화

  - FOUT 현상: HTML문서에서 지정한 폰터가 보이지 않고 기본폰트로 보이다 뒤늦게 폰트적용되는 현상

  - FOIT 현상 :HTML문서에서 지정한 폰터가 보이지 않고 기본 폰트도 없어서 텍스트가 없는 채로 있 다가 폰트가 로딩되면 렌더링 되는 현상

  -Link태그의 preload 사용

폰트의 다운로드를 우선순위로 두고 실패했을때 기본 폰트를 노출 시키는 전략

- 이미지 크기 지정

반응형 이미지를 사용하고 싶다면 srcset속성 사용 (비율이같은 하지만 크기가 다른 여러개의 이미지를 미리준비해 상황에 맞게 로드)

## 이외의 참고할 지표

### 최초 바이트까지의 시간( TTFB)

- TTFB는 브라우저가 웹페이지의 첫 번째 바이트를 수신하는 데 걸리는 시간을 의미합니다. 완전히 완료되는 데 걸리는 시간이 아니라 최초의 응답이 오는 바이트까지가 얼마나 걸리는지 측정하는 지표로, 600ms 이상 걸릴 경우 개선이 필요한 것으로 간주합니다.
- 이는 SSR에서 주의 깊게 봐야 할 지표인데, 대체로 정적인 자원을 지속적으로 제공해 페이지를 렌더링하는 일반적인 SPA와는 달리 SSR은 최초 페이지를 만들기 위해 서버에서 어느 정도 작업을 수행해야 하기 때문입니다.
- 로직을 최적화해 최대한 빨리 준비시키거나, 웹페이지의 주된 방문객의 국적을 파악해 최대한 해당 국적과 가깝게 서버를 위치시키는 것이 좋습니다. ex) AWS라면, 한국 사용자에게는 `use-east-*`보다 `ap-*`(아시아), 그리고 한국에서 가장 가까운 `ap-northeast-2`(서울)

### 최초 콘텐츠풀 페인트(FCP)

- FCP는 웹사이트에 접속한 순간부터 페이지에 뭐라고 뜨기 시작한 시점까지의 시간을 의미하는데, 여기서 의미하는 ‘뭐라도 뜨기 시작한’에 해당하는 요소는 텍스트, 이미지, svg 등을 의미합니다.
- 일반적으로 FCP는 1.8초 이내에 이뤄지면 좋음, 3.0초 이내는 보통, 그 이후는 개선이 필요한 것으로 보고됩니다.
- 렌더링을 가로막는 리소스를 최소화하거나 비동기로 로드해서 렌더링이 일단 최대한 빨리 이뤄지도록 하는 것이 좋고, 게으른 로딩이나 스크립트에 의존해서 렌더링되는 것을 피해야 합니다. 리다이렉트는 없거나 최소한으로 유지해야 하고, DOM 크기를 최소화하는 것도 개선의 방법이 될 수 있습니다.

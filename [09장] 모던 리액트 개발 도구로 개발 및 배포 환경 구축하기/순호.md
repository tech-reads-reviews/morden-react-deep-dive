### GitHub

---

#### GitHub Action

> [! CI ]
> 코드의 변화를 모으고 관리하는 코드 중앙 저장소에서, 기여자가 기여한 코드를 지속적으로 빌드하고 테스트해 코드의 정합성을 확인하는 과정
> CI의 핵심은 저장소에서 코드의 변화가 있을 때마다 전체 **소프트웨어의 정합성을 확인하기 위한 작업을 자동을 실행** 해야함

- GitHub Action은 이러한 CI 기능을 깃허브 저장소와 함께 사용할 수 있는 강력한 도구
- 깃 허브 에서 발생하는 다양한 이벤트를 트리거 삼아 다양한 작업을 할 수 있게 도와주는 것
  1.  깃 허브의 어떤 브랜치에 푸시가 발생하면 빌드를 수행
  2.  깃 허브의 특정 브랜치가 메인 브랜치를 대상으로 풀 리퀘스트가 열리면 빌드, 테스트, 정적 분석을 수행

##### GitHub Action의 기본 개념

- 러너: 파일로 작성된 깃허브 액션이 실행되는 서버
- 액션: 러너에서 실행되는 하나의 작업 단위
- 이벤트: 깃허브 액션의 실행을 일의는 이벤트
  - 풀리퀘스트
  - 이슈
  - 푸시
  - 스케쥴: schedule 이벤트를 활용하여, 매일 또는 매주 정기적으로 자동으로 빌드 및 테스트를 실행하여 프로젝트의 빌드 상태와 테스트가 주기적으로 깨지지 않았는지 확인
    분,시간,일,월,요일 순 으로 표기 ex) 5 4 \* \* \* -> 4시 5분
- 잡: 하나의 러너에서 실행되는 여러 스텝의 모음 (병렬실행)
- 스텝: 잡 내부에서 일어나는 하나하나의 작업 (병렬 실행 x)

> [! 정리]
> 스텝들을 엮어서 잡을 만들고, 이러한 여러 개의 잡은 병렬로 실행, 이러한 잡을 하나 이상 모아둔 것을 액션이라고 한다.

##### GitHub Action 작성

- 액션을 작성하기 위해선 저장소의 루트에 `.github/workfolws` 폴더를 생성하고 내부에 파일 작성

###### 액션 작성

- github action 을 적절히 활용해 다음과 같이 활용 할 수 있음
  - 기본적인 빌드 CI
  - 깃허브 API 를 직접 호출해 깃허브 PR에 댓글 작성
  - 일정 시간 마다 특정 작업을 수행,
  - 배포 서비스와 연동해 자동으로 배포를 실행 하거나 ,
  - 저장소 내부에 이미지가 추가될 때마다 이미지를 최적화

###### 브랜드 보호 규칙

- 머지하기전 꼭 성공해야 하는 액션은 별도 저장소에 브랜치 보호 규칙을 추가 할 수 있음
- **Add branch protection rule**
- main 브랜치에 두가지를 체크
  1.  Require status checks to pass before merging( 머지하기 전에 상태 체크 필수)
  2.  Require branches to be up to date before merging(머지하기 전에 브랜치 최신 내용인지 확인)
- 해당 브랜치가 최신 상태인지 확인하고 머지할 수 있는 기능을 켠다
- 마지막으로 꼭 실행돼야 하는 액션의 파일명을 선택하고 저장하면 해당 액션이 성공하기 전까지는 main 브랜치에 대한 머지를 막을 수 있음
- 기본 브랜치에는 항상 테스트, 빌드와 같은 CI가 성공한 코드만 푸시될 수 있어 코드의 정합성을 확보

#### 직접 장성하지 않고 유용한 액션과 깃허브 앱 가져다 쓰기

- **MarketPlaces**
- 복잡한 작업을 수행하는 액션을 손쉽게 가져다 사용 가능

##### 깃허브에서 제공하는 기본액션

1. actions/checkout
   - 깃허브 저장소를 체크아웃하는 액션
2. actions/setup-node
   - Node.js를 설치하는 액션
3. actions/github-script
   - GitHub API 가 제공하는 기능을 사용할 수 있도록 도와주는 액션
4. actions/stale
   - 오래된 이슈나 PR을 자동으로 닫거나 더 이상 커뮤니케이션하지 못하도록 닫는다. 오래된 저장소 정리에 도움
5. actions/dependency-review-action
   - package.json등의 내용이 변경되었을때 실행
6. github/codeql-action
   - 깃허브 코드 분석 솔루션인 code-ql을 활용해 저장소 내 코드의 취약점을 분석

##### 이외에 다른 액션들

- calibreapp/image-actions
  - 이미지 최적화를 위한 액션, Next.js에는 이미 next/image 로 최적화하는 방법을 제공하지만 저장소 자체의 이미지 크기를 줄인다면 풀 할 때 부담이 줄어든다.
- lirantal/is-website-vunerable
  - 특정 웹사이트를 방문해 해당 웹사이트에 라이브러리 취약점이 존재하는지 확인하는 깃허브 액션
- lighthouse CI
  - 라이트하우스를 CI기를 기반으로 실행할 수 있도록 도와주는 도구

### 정리

---

- 깃허브는 사실상 깃 저장소의 표준
- 기존에 알고있던 깃 허브의 기능 뿐만아니라 코드의 유지보수 보안 취약점 분석등 책에 설명 되어있는 다양한 기능을 활용해 코드를 관리 해야함
